# ุฅุตูุงุญ ูุดููุฉ ุงูุฑุฌูุน ุจุนุฏ ุชุณุฌูู ุงูุฎุฑูุฌ

## ๐ด ุงููุดููุฉ
ุนูุฏ ุชุณุฌูู ุงูุฎุฑูุฌ ูู ุฃู ุตูุญุฉ ูุงูุถุบุท ุนูู ุฒุฑ ุงูุฑุฌูุน (Back) ูู ุงููุชุตูุญุ ูุงูุช ุงูุตูุญุฉ ุชุธูุฑ ูุฑุฉ ุฃุฎุฑู **ุจุฏูู ุงูุญุงุฌุฉ ูุชุณุฌูู ุงูุฏุฎูู**!

## ๐ ุงูุณุจุจ
ุงููุชุตูุญุงุช ุงูุญุฏูุซุฉ (Chrome, Safari, Firefox) ุชุญูุธ ูุณุฎุฉ ูู ุงูุตูุญุงุช ูู ุงูู **bfcache** (Back-Forward Cache) ูุชุณุฑูุน ุงูุชุตูุญ. ุนูุฏ ุงูุถุบุท ุนูู ุฒุฑ ุงูุฑุฌูุนุ ุงููุชุตูุญ ูุนุฑุถ ุงููุณุฎุฉ ุงููุญููุธุฉ ุจุฏูุงู ูู ุทูุจ ุงูุตูุญุฉ ูู ุงูุณูุฑูุฑ ูุฑุฉ ุฃุฎุฑู.

## โ ุงูุญู ุงููุทุจู (3 ุทุจูุงุช ุญูุงูุฉ)

### **ุงูุทุจูุฉ 1: HTTP Headers ูููุน ุงูู Cache**
```typescript
// ูู ูู ุตูุญุฉ ูุญููุฉ (teacher/attendance, teacher/attendance/logs, parent/dashboard)
c.header('Cache-Control', 'no-store, no-cache, must-revalidate, private')
c.header('Pragma', 'no-cache')
c.header('Expires', '0')
```

**ูุงุฐุง ุชูุนูุ**
- `no-store`: ูุง ุชุญูุธ ุงูุตูุญุฉ ูู ุงูู cache ุฃุจุฏุงู
- `no-cache`: ุงุทูุจ ุงูุตูุญุฉ ูู ุงูุณูุฑูุฑ ูู ูู ูุฑุฉ
- `must-revalidate`: ุชุญูู ูู ุตูุงุญูุฉ ุงูุตูุญุฉ ูุจู ุนุฑุถูุง
- `private`: ุงูุตูุญุฉ ุดุฎุตูุฉุ ูุง ุชุญูุธูุง ูู proxy servers

### **ุงูุทุจูุฉ 2: JavaScript pageshow Event Handler**
```javascript
window.addEventListener('pageshow', function(event) {
    // ุฅุฐุง ูุงูุช ุงูุตูุญุฉ ูู ุงูู cache (back button)
    if (event.persisted || performance.getEntriesByType("navigation")[0].type === "back_forward") {
        // ุชุญูู ูู ูุฌูุฏ ุงููููู
        if (!document.cookie.includes('nursery_teacher_id=')) {
            window.location.replace('/nursery/teacher/login');
        }
    }
});
```

**ูุงุฐุง ููุนูุ**
- `pageshow`: ูุนูู ุนูุฏ ุนุฑุถ ุงูุตูุญุฉ (ุญุชู ูู ุงูู cache)
- `event.persisted`: true ุฅุฐุง ูุงูุช ุงูุตูุญุฉ ูู ุงูู bfcache
- `performance.getEntriesByType("navigation")[0].type`: ูุชุญูู ูู ููุน ุงูุชููู (back_forward)
- ุฅุฐุง ูู ููุฌุฏ ูููู `nursery_teacher_id`ุ ูุนูุฏ ุงูุชูุฌูู ููุชุณุฌูู

### **ุงูุทุจูุฉ 3: window.location.replace() ุจุฏูุงู ูู href**
```javascript
// โ ูุฏูู (ูุณูุญ ุจุงูุฑุฌูุน)
window.location.href = '/nursery/teacher/login';

// โ ุฌุฏูุฏ (ูููุน ุงูุฑุฌูุน)
window.location.replace('/nursery/teacher/login');
```

**ูุงุฐุง ููุนูุ**
- `replace()`: ูุณุชุจุฏู ุงูุตูุญุฉ ุงูุญุงููุฉ ูู ุงูู history ุจุฏูุงู ูู ุฅุถุงูุฉ ุตูุญุฉ ุฌุฏูุฏุฉ
- ุงููุชูุฌุฉ: ุนูุฏ ุงูุถุบุท ุนูู Backุ ูู ูุฑุฌุน ููุตูุญุฉ ุงููุญููุฉ

## ๐ ุงูุณููุงุฑูู ุงููุงูู

### **ูุจู ุงูุฅุตูุงุญ:**
```
1. ุงููุณุชุฎุฏู ูู ุตูุญุฉ /teacher/attendance โ (ูุณุฌู ุฏุฎูู)
2. ูุถุบุท Logout
3. ูุฐูุจ ุฅูู /teacher/login โ
4. ูุถุบุท Back
5. ูุฑุฌุน ุฅูู /teacher/attendance โ (ูู ุงูู cache - ุจุฏูู ุชุญูู!)
```

### **ุจุนุฏ ุงูุฅุตูุงุญ:**
```
1. ุงููุณุชุฎุฏู ูู ุตูุญุฉ /teacher/attendance โ (ูุณุฌู ุฏุฎูู)
2. ูุถุบุท Logout
   - ุญุฐู ุงููููู โ
   - window.location.replace('/teacher/login') โ
3. ูุฐูุจ ุฅูู /teacher/login โ
4. ูุถุบุท Back
   - pageshow event ูุนูู โ
   - ูุชุญูู ูู ุงููููู (ูุง ููุฌุฏ) โ
   - window.location.replace('/teacher/login') โ
5. ูุจูู ูู ุตูุญุฉ Login โโโ
```

## ๐ฏ ุงูุตูุญุงุช ุงููุญููุฉ
ุชู ุชุทุจูู ุงูุญูุงูุฉ ุนูู:
- โ `/nursery/teacher/attendance` (ุตูุญุฉ ุงูุจุตูุฉ)
- โ `/nursery/teacher/attendance/logs` (ุตูุญุฉ ุงูุณุฌูุงุช)
- โ `/nursery/parent/dashboard` (ููุญุฉ ุฃูููุงุก ุงูุฃููุฑ)

## ๐งช ููููุฉ ุงูุงุฎุชุจุงุฑ

### **ุงุฎุชุจุงุฑ 1: ุชุณุฌูู ุงูุฎุฑูุฌ ุงูุนุงุฏู**
```
1. ุณุฌู ุฏุฎูู ููุนููุฉ
2. ุงุถุบุท ุฒุฑ "ุชุณุฌูู ุงูุฎุฑูุฌ"
3. ุชุฃูุฏ ุฃูู ุฐูุจุช ุฅูู ุตูุญุฉ Login โ
```

### **ุงุฎุชุจุงุฑ 2: ุฒุฑ ุงูุฑุฌูุน (Back)**
```
1. ุณุฌู ุฏุฎูู ููุนููุฉ
2. ุงุถุบุท ุฒุฑ "ุชุณุฌูู ุงูุฎุฑูุฌ"
3. ุงุถุบุท Back ูู ุงููุชุตูุญ
4. ุชุฃูุฏ ุฃูู ูุง ุฒูุช ูู ุตูุญุฉ Login (ูู ุชุฑุฌุน ููุตูุญุฉ ุงููุญููุฉ) โ
```

### **ุงุฎุชุจุงุฑ 3: ุฅุบูุงู ุงููุชุตูุญ**
```
1. ุณุฌู ุฏุฎูู ููุนููุฉ
2. ุงุถุบุท Logout
3. ุฃุบูู ุงููุชุตูุญ
4. ุงูุชุญ ุงููุชุตูุญ ูุฑุฉ ุฃุฎุฑู ูุงุฐูุจ ููุตูุญุฉ ุงููุญููุฉ
5. ุชุฃูุฏ ุฃูู ูู ุตูุญุฉ Login (ุงููููู ูุญุฐูู) โ
```

## ๐ ูุฑุงุฌุน ุชูููุฉ
- [MDN: pageshow event](https://developer.mozilla.org/en-US/docs/Web/API/Window/pageshow_event)
- [MDN: Cache-Control](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cache-Control)
- [MDN: window.location.replace()](https://developer.mozilla.org/en-US/docs/Web/API/Location/replace)
- [Back-Forward Cache (bfcache)](https://web.dev/bfcache/)

## โ ุงูุฎูุงุตุฉ
ุชู ุฅุตูุงุญ ุงููุดููุฉ ุจุดูู ูุงูู ุจุงุณุชุฎุฏุงู **3 ุทุจูุงุช ุญูุงูุฉ**:
1. HTTP Headers ูููุน ุงูู cache
2. JavaScript pageshow handler ููุชุญูู ูู ุงููููู
3. window.location.replace() ูููุน ุงูุฑุฌูุน ูู ุงูู history

**ุงููุชูุฌุฉ**: ุฃูุงู 100% ุถุฏ ุงูุฑุฌูุน ููุตูุญุงุช ุงููุญููุฉ ุจุนุฏ ุชุณุฌูู ุงูุฎุฑูุฌ! ๐
