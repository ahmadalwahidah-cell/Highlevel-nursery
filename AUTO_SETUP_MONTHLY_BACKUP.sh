#!/bin/bash

###############################################################################
# ๐ ุฅุนุฏุงุฏ ุงููุณุฎ ุงูุงุญุชูุงุทู ุงูุดูุฑู ุงูุชููุงุฆู
###############################################################################
# ูุฐุง ุงูุณูุฑุจุช ููุนุฏ ูู ุดูุก ุชููุงุฆูุงู - ูุง ุชุญุชุงุฌ ุฃู ูุนุฑูุฉ ุชูููุฉ!
#
# ูุงุฐุง ููุนูุ
#   1. ููุดุฆ ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูู ุดูุฑ (ููู 1 ูู ูู ุดูุฑุ ุงูุณุงุนุฉ 2 ุตุจุงุญุงู)
#   2. ูุญูู ุงูุจูุงูุงุช ุฅูู Excel
#   3. ูุฑุณููุง ุนูู ุฅููููู: high.level.mutlaa@gmail.com
#
# ููู ุชุดุบููุ
#   ููุท ุดุบู ูุฐุง ุงูุฃูุฑ ูุฑุฉ ูุงุญุฏุฉ:
#   bash AUTO_SETUP_MONTHLY_BACKUP.sh
#
# ุจุนุฏ ุฐููุ ูู ุดูุก ุณูุนูู ุชููุงุฆูุงู!
###############################################################################

# ุงูุฃููุงู
GREEN='\033[0;32m'
CYAN='\033[0;36m'
YELLOW='\033[1;33m'
MAGENTA='\033[0;35m'
NC='\033[0m'

echo ""
echo -e "${MAGENTA}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
echo -e "${MAGENTA}   ๐ ุฅุนุฏุงุฏ ุงููุณุฎ ุงูุงุญุชูุงุทู ุงูุดูุฑู ุงูุชููุงุฆู${NC}"
echo -e "${MAGENTA}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
echo ""

PROJECT_DIR="/home/user/highlevel-nursery"
SCRIPT_PATH="$PROJECT_DIR/scripts/send-backup-email.sh"

echo -e "${CYAN}๐ง ุงูุฅูููู: high.level.mutlaa@gmail.com${NC}"
echo -e "${CYAN}๐ ุงูุฌุฏููุฉ: ููู 1 ูู ูู ุดูุฑุ ุงูุณุงุนุฉ 2:00 ุตุจุงุญุงู${NC}"
echo ""

# ุงูุชุญูู ูู ูุฌูุฏ ุงูุณูุฑุจุช
if [ ! -f "$SCRIPT_PATH" ]; then
    echo -e "${YELLOW}โ๏ธ  ุงูุณูุฑุจุช ุบูุฑ ููุฌูุฏ: $SCRIPT_PATH${NC}"
    exit 1
fi

# ุฅูุดุงุก ูููุฉ Cron ูููุณุฎ ุงูุดูุฑู
CRON_JOB="0 2 1 * * cd $PROJECT_DIR && bash $SCRIPT_PATH >> $PROJECT_DIR/backups/monthly_email.log 2>&1"

echo -e "${CYAN}โ๏ธ  ุฌุงุฑู ุงูุฅุนุฏุงุฏ...${NC}"
echo ""

# ุงูุชุญูู ูู ูุฌูุฏ crontab
if ! command -v crontab &> /dev/null; then
    echo -e "${YELLOW}โ๏ธ  crontab ุบูุฑ ูุชููุฑ ูู ูุฐู ุงูุจูุฆุฉ${NC}"
    echo ""
    echo -e "${CYAN}๐ก ุงูุญู ุงูุจุฏูู:${NC}"
    echo "   ูู ุณูุฑูุฑ ุงูุฅูุชุงุฌุ ุดุบูู ูุฐู ุงูุฃูุงูุฑ:"
    echo ""
    echo "   1. ุงูุชุญ crontab:"
    echo -e "      ${GREEN}crontab -e${NC}"
    echo ""
    echo "   2. ุฃุถู ูุฐุง ุงูุณุทุฑ:"
    echo -e "      ${GREEN}$CRON_JOB${NC}"
    echo ""
    echo "   3. ุงุญูุธ ูุงุฎุฑุฌ (Ctrl+X, ุซู Y, ุซู Enter)"
    echo ""
    echo -e "${YELLOW}๐ ุฃู ุงูุณุฎ ูุฐุง ุงูุณุทุฑ ูุฃุฑุณูู ูููุจุฑูุฌ:${NC}"
    echo -e "${GREEN}$CRON_JOB${NC}"
    echo ""
    
    # ุญูุธ ุงูุชุนูููุงุช ูู ููู
    SETUP_FILE="$PROJECT_DIR/MONTHLY_BACKUP_SETUP_INSTRUCTIONS.txt"
    cat > "$SETUP_FILE" << EOF
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
   ๐ง ุชุนูููุงุช ุฅุนุฏุงุฏ ุงููุณุฎ ุงูุงุญุชูุงุทู ุงูุดูุฑู
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

ุงูุฅูููู: high.level.mutlaa@gmail.com
ุงูุฌุฏููุฉ: ููู 1 ูู ูู ุดูุฑุ ุงูุณุงุนุฉ 2:00 ุตุจุงุญุงู

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
   ุงูุฎุทูุงุช (ูู ุณูุฑูุฑ ุงูุฅูุชุงุฌ):
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

1. ุงูุชุญ Terminal (ุงูุทุฑููุฉ)

2. ุดุบูู ูุฐุง ุงูุฃูุฑ:
   crontab -e

3. ุฃุถู ูุฐุง ุงูุณุทุฑ ูู ููุงูุฉ ุงูููู:
   $CRON_JOB

4. ุงุญูุธ ูุงุฎุฑุฌ:
   - ุงุถุบุท Ctrl+X
   - ุงุถุบุท Y
   - ุงุถุบุท Enter

5. ุชุฃูุฏ ูู ุงูุฅุนุฏุงุฏ:
   crontab -l

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
   โ ุจุนุฏ ุงูุฅุนุฏุงุฏ:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

ุณูุตูู Email ุชููุงุฆูุงู ูู ุดูุฑ ูุญุชูู ุนูู:
  โ ููู Excel ุดุงูู ุจุฌููุน ุงูุจูุงูุงุช
  โ ุชูุฑูุฑ ุงููุณุฎ ุงูุงุญุชูุงุทู

ูู ุชุญุชุงุฌ ุฃู ุดูุก ุขุฎุฑ - ูู ุดูุก ุชููุงุฆู!

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
EOF
    
    echo -e "${GREEN}โ ุชู ุญูุธ ุงูุชุนูููุงุช ูู:${NC}"
    echo -e "   ${CYAN}$SETUP_FILE${NC}"
    echo ""
else
    # ุฅุถุงูุฉ Cron Job
    # ุญุฐู ุฃู ููุงู ุณุงุจูุฉ ูุดุงุจูุฉ
    crontab -l 2>/dev/null | grep -v "send-backup-email.sh" | crontab - 2>/dev/null
    
    # ุฅุถุงูุฉ ุงููููุฉ ุงูุฌุฏูุฏุฉ
    (crontab -l 2>/dev/null; echo "$CRON_JOB") | crontab -
    
    echo -e "${GREEN}โ ุชู ุงูุฅุนุฏุงุฏ ุจูุฌุงุญ!${NC}"
    echo ""
    echo -e "${CYAN}๐ ุงููููุฉ ุงููุฌุฏููุฉ:${NC}"
    crontab -l | grep "send-backup-email"
    echo ""
fi

# ุงุฎุชุจุงุฑ ุงูุณูุฑุจุช
echo -e "${CYAN}๐งช ุงุฎุชุจุงุฑ ุงูุณูุฑุจุช ุงูุขู...${NC}"
echo ""

bash "$SCRIPT_PATH"

echo ""
echo -e "${GREEN}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
echo -e "${GREEN}   โ ุงูุชูู ุงูุฅุนุฏุงุฏ!${NC}"
echo -e "${GREEN}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
echo ""
echo -e "${CYAN}๐ง ุณูุตูู Email ูู ุดูุฑ ุนูู:${NC}"
echo -e "   ${YELLOW}high.level.mutlaa@gmail.com${NC}"
echo ""
echo -e "${CYAN}๐ ููุนุฏ ุงูุฅุฑุณุงู:${NC}"
echo -e "   ${YELLOW}ููู 1 ูู ูู ุดูุฑุ ุงูุณุงุนุฉ 2:00 ุตุจุงุญุงู${NC}"
echo ""
echo -e "${CYAN}๐ ุงููุญุชูู:${NC}"
echo -e "   ${YELLOW}โ ููู Excel ุดุงูู ุจุฌููุน ุงูุจูุงูุงุช${NC}"
echo -e "   ${YELLOW}โ ุชูุฑูุฑ ุงููุณุฎ ุงูุงุญุชูุงุทู${NC}"
echo ""
echo -e "${GREEN}๐ ูู ุชุญุชุงุฌ ูุนู ุฃู ุดูุก - ูู ุดูุก ุชููุงุฆู!${NC}"
echo ""
